document.querySelectorAll||(document.querySelectorAll=function(t){var e,i=document.createElement("style"),n=[];for(document.documentElement.firstChild.appendChild(i),document._qsa=[],i.styleSheet.cssText=t+"{x-qsa:expression(document._qsa && document._qsa.push(this))}",window.scrollBy(0,0),i.parentNode.removeChild(i);document._qsa.length;)e=document._qsa.shift(),e.style.removeAttribute("x-qsa"),n.push(e);return document._qsa=null,n}),document.querySelector||(document.querySelector=function(t){var e=document.querySelectorAll(t);return e.length?e[0]:null}),function(){function t(){var e={},i=!1,n=null,o=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(i=arguments[0],n++);for(n=0;n<o;n++){var s=arguments[n];!function(n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(i&&"[object Object]"===Object.prototype.toString.call(n[o])?e[o]=t(!0,e[o],n[o]):e[o]=n[o])}(s)}return e}function e(t){var e=t.getBoundingClientRect(),i=document.body,n=document.documentElement,o=window.pageYOffset||n.scrollTop||i.scrollTop,s=window.pageXOffset||n.scrollLeft||i.scrollLeft,r=n.clientTop||i.clientTop||0,l=n.clientLeft||i.clientLeft||0;return{top:e.top+o-r,left:e.left+s-l}}function i(t,e){for(var i=t.className?t.className.split(" "):[],n=0;n<i.length;n++)if(i[n]==e)return;i.push(e),t.className=i.join(" ")}function n(t,e){for(var i=t.className.split(" "),n=0;n<i.length;n++)i[n]==e&&(i.splice(n,1),n--);t.className=i.join(" ")}function o(t){var e=document.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return e?decodeURIComponent(e[1]):void 0}function s(t,e,i){var n=null;return e=e||100,function(){function o(){i||t.apply(s,r),n=null}var s=this,r=arguments;null!==n?clearTimeout(n):i&&t.apply(s,r),n=setTimeout(o,e)}}function r(t){return!(0===t.offsetWidth&&0===t.offsetHeight)}function l(t){if(t=t||600,(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<=t)return!0;for(var e=navigator.userAgent,i=[/iPhone/i,/iPod/i,/iPad/i,/Android/i,/IEMobile/i,/(?=.*\bWindows\b)(?=.*\bARM\b)/i,/BlackBerry/i,/BB10/i,/Opera Mini/i,/(CriOS|Chrome)(?=.*\bMobile\b)/i,/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,/(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)/i],n=0,o=i.length;n<o;++n)if(i[n].test(e))return!0;return!1}function a(){var t=document.querySelector('link[rel="canonical"]');return t&&t.getAttribute("href"),window.location.href}function c(){return{top:window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop,left:window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft,width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}}function u(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e.join("&")}function h(t){this.name="Медиатор",this.message=t||"Возникла ошибка"}function d(t){throw new h(t)}h.prototype=Object.create(Error.prototype),h.prototype.constructor=h,window._mediatorUtils=t(window._mediatorUtils||{},{extend:t,offset:e,addClass:i,removeClass:n,getCookie:o,debounce:s,isMobile:l,isVisible:r,getLocation:a,getViewportSizes:c,console:d,objectToUrlParams:u})}(),function(){"use strict";function t(){var t=O.getElementById("js-mpf-mediator-init"),e=J.attrs,i={counter:parseInt(t.getAttribute(e.counter)),touchCounter:parseInt(t.getAttribute(e.touchCounter)),sectionByClass:"true"===t.getAttribute(e.useSection),adaptive:"true"===t.getAttribute(e.adaptive),autostart:!("false"===t.getAttribute(e.autostart)),orientation:t.getAttribute(e.orientation)||"vertical"};return i.counter&&i.touchCounter&&(i.adaptive=!0),i.touchCounter&&(i.isMobile=!0,i.counter=i.touchCounter),delete i.touchCounter,i}function e(e){e=e||null;var i=e?this._opts:N(!0,J,D._opts||{},t());return N(!0,{},i,e)}function i(t){"object"!=typeof t&&X("Переданные опции указаны неверно");var i={cssSels:{}};void 0!==t.target&&(t.target instanceof HTMLElement?i.rootElement=t.target:X("Контейнер указан неверно")),void 0!==t.targetSelector&&("string"==typeof t.targetSelector&&t.targetSelector?i.cssSels.scrollCont=t.targetSelector:X("Селектор на контейнер указан неверно")),void 0!==t.article&&(t.article&&t.article.length?i.articleElement=t.article:t.article instanceof HTMLElement?i.articleElement=[t.article]:X("Контейнер статьи указан неверно")),void 0!==t.articleSelector&&("string"==typeof t.articleSelector&&t.articleSelector?i.cssSels.article=t.articleSelector:X("Селектор на контейнер указан неверно")),"boolean"==typeof t.isMobile?i.isMobile=t.isMobile:void 0!==t.isMobile&&X("Флаг типа устройства указан неверно"),void 0!==t.url&&("string"==typeof t.url?this._state.pathname=t.url:X("Ссылка на страницу указана неверно")),this._opts=e.call(this,i),w.call(this)}function n(){var t=window.navigator.userLanguage||window.navigator.language;return{_timers:{},_handlers:[],_sizes:{},_marks:[],_nodes:null,_events:{scrolls:{},reads:{}},referrer:O.referrer,pathname:R.getLocation(),lang:Q[t]?t:"en",isInited:!1,isStarted:!1,noArticle:!1}}function o(t){var e=this._opts,i=e.templates;if(e.showRule&&t in i){var n=O.createElement("template"),o=Q[this._state.lang][t];n.innerHTML=i[t].replace(/\${(\w+)}/g,function(t,e){return o[e]});var s=n.content.firstChild;O.body.appendChild(s)}}function s(t){t=t||this._elems.parent;var e=t.querySelectorAll(this._opts.cssSels.section);return[].reduce.call(e,function(t,e){return e.offsetParent&&t.push(e),t},[])}function r(){var t=this._opts,e=t.cssSels,i=t.rootElement||O.querySelector(e.scrollCont);i||(i=O.querySelector("body"));var n={parent:i};return t.sectionByClass?(n.section=s.call(this,i),n.section.length||X("Не найдена ни одна секция")):(n.article=t.articleElement||i.querySelectorAll(e.article),n.article&&(n.article||{}).length||(n.article=i.querySelectorAll("article")),n.article&&(n.article||{}).length||(n.article=[i],this._state.noArticle=!0,o.call(this,"noArticle"))),n}function l(t,e){O.addEventListener(t||"visibilitychange",e)}function a(t,e,i){i=i||window;for(var n=this._state,o=n._handlers,s=t.split(" "),r=!window.addEventListener,a=0;a<s.length;a++){var c={el:i,name:"",func:e,ie:r},u=s[a];"visibilitychange"==u?(c.el=O,"hidden"in O?(c.name=u,l(c.name,e)):"mozHidden"in O?(c.name="mozvisibilitychange",l(c.name,e)):"webkitHidden"in O?(c.name="webkitHidden",l(c.name,e)):"webkitvisibilitychange"in O?(c.name="webkitvisibilitychange",l(c.name,e)):"msHidden"in O?(c.name="msHidden",l(c.name,e)):"onfocusin"in O?O.onfocusin=O.onfocusout=e:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=e):r?(u="on"+u,c.name=u,i.attachEvent(u,e)):(c.name=u,i.addEventListener(u,e)),o.push(c)}}function c(){var t=this._state,e=this._elems.parent,i=this._opts.timeouts,n=g.bind(this),o=u.bind(this);this.IdleCallback||(this.IdleCallback=U(z.bind(this),i.sleep));var s=this.IdleCallback,r=w.bind(this),l=a.bind(this);l("resize",U(o,i.resize)),O.body!==e?l("scroll",U(function(){t.isActivePage=!0,s(),o(),n()},i.scroll),e):l("scroll",U(n,i.scroll)),l("load",o),l("hashchange",r),l("visibilitychange blur focus",function(t){t=t||window.event,s();var e=t.type,i=e in Z?Z[e]:!O.hidden;_.call(this,i,e)}.bind(this)),l("load resize scroll click touchstart keydown hashchange",U(function(t){t=t||window.event,s(),_.call(this,null,t.type)}.bind(this),300,!0)),s()}function u(){var t=this._state;d.call(this),f.call(this),m.call(this),t.isStarted&&g.call(this)}function h(t){var e=[],i=[],n=0;return t&&t.length?(n=t.length-1,[].forEach.call(t,function(t){e.push(t.getBoundingClientRect()),i.push(W(t))})):(e.push(t.getBoundingClientRect()),i.push(W(t))),{rect:{left:e[0].left,right:e[0].right,top:e[0].top,bottom:e[n].bottom,width:e[0].width||e[0].right-e[0].left,height:i[n].top-i[0].top+(e[n].bottom-e[n].top)},offset:i[0]}}function d(){var t=this._elems,e=this._state,i=e._sizes={};for(var n in t)if(t.hasOwnProperty(n)&&t[n]){var o=t[n];if("section"===n&&(o||[]).length){i[n]=[];for(var s=0;s<o.length;s++)i[n][s]=h(o[s])}else{if("article"===n){var r=(o||{}).length;"number"==typeof r&&r>2&&(o=[o[0],o[r-1]])}i[n]=h(o)}}}function p(t){var e=this._opts,i=e.section.count,n=this._elems.section.length,o=Math.floor(n/i),s=o?Math.floor(t/o):t;return s>(i-=1)?i:s}function f(){var t,e,i,n,o=this._elems,s=this._opts,r=this._state,l=r._sizes,a=r._marks,c=K[s.orientation];if(s.sectionByClass)for(t=o.section.length,e=0;e<=t;e++){var u=e==t?e-1:e,h=l.section[u],d=h.offset[c.section.start];n={start:d,end:d+h.rect[c.section.size]},i=a[e],i||(i={}),i.meta=p.call(this,e),i.pos=e==t?n.end:n.start,i.start=i.pos+s.section.triggerStep,a[e]=i}else{t=s.section.count;var f=l.article.offset[c.article.start],m=l.article.rect[c.article.size],g=r.sectionSize=m/t;for(n={start:f,end:f+m},g<s.section.minSize&&(t=Math.floor(m/s.section.minSize),g=m/t),e=0;e<=t;e++)i=a[e],i||(i={}),i.pos=e==t?n.end:n.start+g*e,i.start=i.pos+s.section.triggerStep,a[e]=i}}function m(){function t(t){var e=this._opts,i=K[e.orientation],n=i.mark.style,o=O.createElement("div"),s=O.createElement("span");return s.style.cssText=t?n.labelLast:n.label,o.appendChild(s),F(o,e.cssClss.mark),o.style.cssText=n.mark,o}function e(t,e){var i=this._state.lang,n=Q[i];return t<e?n.start+" "+n.section+" "+t:n.end+" "+n.section+" "+(t-1)}var i,n=this._opts,o=this._state,s=o._marks,r=o._nodes,l=K[n.orientation];if(r||(r=[]),n.showRule){var a=[],c=O.createDocumentFragment(),u="",h=Math.max(r.length,s.length);for(i=0;i<h;i++){var d=s[i],p=r[i];d?(p||(p=t.call(this,i==h-1),c.appendChild(p)),p.style[l.mark.pos]=d.pos+"px",u=e.call(this,i+1,s.length),p.firstChild.textContent=u,p.firstChild.innerText=u,a[i]=p):p&&O.body.removeChild(p)}O.body.appendChild(c),o._nodes=a}else{if(r.length){for(i=0;i<r.length;i++)O.body.removeChild(r[i]);r=null}o._nodes=r}}function g(){var t=this._state,e=this._elems,i=this._opts,n=[].every.call(i.sectionByClass?e.section:e.article,$);if(t.isActivePage&&t.isInited&&t.isStarted&&n){var o=t._marks,s=t._sizes,r=K[i.orientation],l=R.getViewportSizes(),a=l[r.viewport.start],c=l[r.viewport.size];e.parent!=O.body&&(a=s.parent.offset[r.parent.offsetStart],c=Math.min(c,e.parent[r.parent.clientSize]));for(var u=a+c*i.triggerArea,h=a+c,d=i.sectionByClass?e.section.length:i.section.count,p=i.sectionByClass?o[d].pos:s.article.offset[r.article.start]+s.article.rect[r.article.size],f={reading:t.readingSection,current:null},m=0;m<o.length;m++){var g=o[m];g.pos<h&&(B.call(this,"s",m),m<d&&g.start<u&&(f.current=m))}p<a&&(f.current=null),f.current!=f.reading&&(t.readingSection=f.current,b.call(this))}}function b(){var t=this._opts,e=this._elems,i=this._state,n=t.timeouts.hit,o=i._timers.hit;o&&clearTimeout(o),"number"==typeof i.readingSection&&(i._timers.hit=setTimeout(function o(){var s=i.readingSection,r=[].every.call(t.sectionByClass?e.section:e.article,$);i.isStarted&&i.isActivePage&&"number"==typeof s&&r&&(B.call(this,"ts",s),B.call(this,"t",s)),i._timers.hit=setTimeout(o.bind(this),n)}.bind(this),n))}function v(){var t=this._opts;t.isMobile=t.adaptive?V():t.isMobile}function y(){var t=this._elems,e=this._opts,i=this._state,n=K[e.orientation],o=O.documentElement[n.page.scrollSize],r=i._sizes.parent.rect[n.parent.size],l=e.timeouts.size;(function a(){var c=O.documentElement[n.page.scrollSize],d=h(t.parent).rect[n.parent.size],p=[].every.call(e.sectionByClass?t.section:t.article,$);c===o&&r===d||!p||(o=c,r=d,e.sectionByClass&&(t.section=s.call(this)),u.call(this)),i._timers.size=setTimeout(a.bind(this),l)}).bind(this)()}function w(){var t=this._state,e=this._opts,i=O.location.hash.slice(1);if((i===e.hashes.showRule||i===e.hashes.debug)&&(e.showRule=!0,t.isStarted&&m.call(this),t.noArticle)){O.querySelector(e.cssSels.notice)||o.call(this,"noArticle")}i===e.hashes.debug&&(e.debug=!0)}function _(t,e){var i=this._state;"boolean"!=typeof t&&(t=!O.hidden),i.isActivePage=t,this._opts.debug&&(console.log("Медиатор: активность окна "+t+(e?" ("+e+")":"")),O.title=t+(e?" ("+e+")":"")),t&&i.isStarted&&g.call(this)}function S(){var t=this._state,e=t._timers;for(var i in e)e.hasOwnProperty(i)&&clearTimeout(i)}function x(){this._state._handlers.forEach(function(t){var e=t.func,i=t.name,n=t.el;t.ie?n.detachEvent(i,e):n.removeEventListener(i,e)})}function C(t){var e=this._state;e.isInited||X("невозможно изменить статус активности модуля без предворительной инициализации");var i=e.isStarted,n=t;"boolean"==typeof t?i===t&&X("Ошибка установки активности модуля"):n=!i,e.isStarted=n}function E(){return this._state.isStarted}function z(){this._state.isStarted&&(this._state.isActivePage=!1,this._opts.debug&&console.log("Медиатор: пользователь не активен"))}function k(t){var e="";if(3===t.nodeType)e=t.nodeValue;else if(1===t.nodeType&&-1===tt.indexOf(t.nodeName))for(var i=t.childNodes,n=i.length;n--;)e+=k(i[n]);return e}function A(t){return t=(t||{}).length?t:[t],[].reduce.call(t,function(t,e){return t+=k(e)},"")}function T(){var t=this._elems,e=this._opts,i=e.sectionByClass?t.section:t.article,n=A(i);n=n.replace(/[\.\,\?\!]/g," ");var o=n.split(/\s/).filter(function(t){return t.length>2});this._state.wordsCount=o.length}function B(t,e){var i=this._opts,n=this._state,o=n._events,s=n._marks,r=o["s"===t?"scrolls":"ts"===t?"reads":""],l=s[e],a=i.sectionByClass,c=M.bind(this);[t+(a?l.meta:e)].forEach(function(t){r?r[t]||(c({type:t}),r[t]=!0):c({type:t})})}function M(t){var e=this._opts,i=this._state,n={cid:e.counter,url:i.pathname,ref:i.referrer,p:e.isMobile?2:1,e:t.type};"v"===t.type&&(n.wc=i.wordsCount),j(n),e.debug&&console.log("Медиатор: "+(H.stringify?H.stringify(n):n)),"function"==typeof e.onPushEvent&&e.onPushEvent({id:e.counter,type:"sendEvent",action:i.pathname,label:[e.isMobile?"mobile":"desktop"].concat("v"==t.type?[i.wordsCount]:[]).join(","),category:t.type,value:2})}function j(t){var e=Y(t);(new Image).src="//collector.mediator.media/register/?"+e}function q(){this._opts=e.call(this),this._state=n.call(this),w.call(this),v.call(this),isNaN(this._opts.counter)&&X("Идентификатор счётчика указан неверно"),this._state.isInited=!0}function L(){this._elems=r.call(this),c.call(this),u.call(this),_.call(this),y.call(this),T.call(this),M.call(this,{type:"v"}),C.call(this,!0)}function P(){this._state.isStarted||(x.call(this),S.call(this))}function I(t){t=t||null;var e=this._state;if(e.isInited)try{e.isStarted&&X("Модуль уже запущен. Сначала необхдимо остановить его работу"),q.call(this),t&&(i.call(this,t),v.call(this)),L.call(this),_.call(this)}catch(t){console.error(t.name+": "+t.message)}}var O=window.document,R=window._mediatorUtils;if(R){var H=window.JSON||{},N=R.extend,W=R.offset,F=R.addClass,U=R.debounce,V=R.isMobile,$=R.isVisible,X=R.console,Y=R.objectToUrlParams,D={};window._mediator&&(D=window._mediator);var G={},J={cssSels:{scrollCont:".js-mediator-container",article:".js-mediator-article",section:".js-mediator-section",notice:".js-mediator-notice"},cssClss:{mark:"js-mediator-mark"},attrs:{autostart:"data-autostart",useSection:"data-use-section",counter:"data-counter",touchCounter:"data-mobile-counter",adaptive:"data-adaptive",orientation:"data-orientation"},hashes:{showRule:"mediator",debug:"mediator-debug"},timeouts:{sleep:3e4,hit:5e3,size:2e3,scroll:300,resize:500},section:{minSize:0,count:3,triggerStep:0},rootElement:!1,articleElement:!1,counter:null,showRule:!1,isMobile:!1,sectionByClass:!1,triggerArea:.33,debug:!1,onPushEvent:null,templates:{noArticle:'<div class="js-mediator-notice" style="position: fixed;left: 0px;right: 0px;height: 32px;z-index: 9999;background: #f4e34e;top: 0;font-family: Arial;font-size: 17px;color: black;line-height: 32px;text-align: center;"><span style="font-weight: bold;"><span style="color: #F44E4E;">✘</span>&nbsp;${title}:</span>&nbsp;${text}</div>'}},K={vertical:{viewport:{start:"top",size:"height"},page:{scrollSize:"scrollHeight"},parent:{offsetStart:"top",clientSize:"clientHeight",size:"height"},article:{start:"top",size:"height"},section:{start:"top",size:"height"},mark:{pos:"top",style:{mark:"position: absolute; left: 0px; right: 0px; height: 4px; z-index: 9999; background: #F44E4E;",label:"position: absolute; top: -28px; left: 16px; font-family: Arial; font-size: 15px; color: white; background: #F44E4E; line-height: 32px; padding: 0 16px; display: inline-block; border-radius: 3px;",labelLast:"position: absolute; top: -28px; left: 16px; font-family: Arial; font-size: 15px; color: white; background: #F44E4E; line-height: 32px; padding: 0 16px; display: inline-block; border-radius: 3px;"}}},horizontal:{viewport:{start:"left",size:"width"},page:{scrollSize:"scrollWidth"},parent:{offsetStart:"left",clientSize:"clientWidth",size:"width"},article:{start:"left",size:"width"},section:{start:"left",size:"width"},mark:{pos:"left",style:{mark:"position: absolute; bottom: 0px; top: 0px; width: 4px; z-index: 9999; background: #F44E4E;",label:"position: relative; top: 0px; left: 0px; width: 120px; font-family: Arial; font-size: 15px; color: white; background: #F44E4E; line-height: 32px; padding: 0 16px; display: inline-block; border-radius: 3px;",labelLast:"position: relative; top: 0px; left: -152px; width: 120px; font-family: Arial; font-size: 15px; color: white; background: #F44E4E; line-height: 32px; padding: 0 16px; display: inline-block; border-radius: 3px;"}}}},Q={ru:{start:"Начало",end:"Конец",section:"секции",noArticle:{title:"Предупреждение",text:"на странице отсутствует контейнер для статьи"}},en:{start:"Begin",end:"End",section:"section",noArticle:{title:"Warning",text:"there is no container for the article on the page"}}},Z={focus:!0,focusin:!0,pageshow:!0,blur:!1,focusout:!1,pagehide:!1},tt=["TEXTAREA","SCRIPT","STYLE"];window._mediator=function(){try{q.call(G),G._opts.autostart?L.call(G):P.call(G)}catch(t){console.error(t.name+": "+t.message)}var t=C.bind(G),e=function(){this._opts.showRule=!1,m.call(this)}.bind(G);return{start:function(t){I.call(G,t)},stop:function(){t(!1),e(),P.call(G)},pause:function(){t(!1)},continue:function(){t(!0)},redraw:function(){G._opts.sectionByClass&&(G._elems.section=s.call(G)),u.call(G)},isActive:function(){return E.call(G)}}}()}}();
//# sourceMappingURL=mpf-mediator.min.js.map
